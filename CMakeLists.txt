PROJECT(md5sum-osx)
CMAKE_MINIMUM_REQUIRED(VERSION 2.8.4)
CMAKE_POLICY(VERSION 2.8.4)

INCLUDE(CTest)
ENABLE_TESTING()

#INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR})

SET(COMMON_SOURCES "util.c")

SET(MD5SUM_SOURCES md5.c md5sum.c ${COMMON_SOURCES})
SET(SHA256SUM_SOURCES sha256.c sha256sum.c ${COMMON_SOURCES})
SET(SHA512SUM_SOURCES sha512.c sha512sum.c ${COMMON_SOURCES})

IF(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
    SET(SHA256SUM_SOURCES ${SHA256SUM_SOURCES} external/sha2.c)
    SET(SHA512SUM_SOURCES ${SHA512SUM_SOURCES} external/sha2.c)
ENDIF(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")


ADD_EXECUTABLE(md5sum ${MD5SUM_SOURCES})

ADD_EXECUTABLE(sha256sum ${SHA256SUM_SOURCES})

ADD_EXECUTABLE(sha512sum ${SHA512SUM_SOURCES})

IF(NOT ${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
    TARGET_LINK_LIBRARIES(md5sum "crypto")
    TARGET_LINK_LIBRARIES(sha256sum "crypto")
    TARGET_LINK_LIBRARIES(sha512sum "crypto")
ENDIF(NOT ${CMAKE_SYSTEM_NAME} MATCHES "Darwin")

INSTALL(TARGETS md5sum sha256sum sha512sum RUNTIME DESTINATION bin)

ADD_SUBDIRECTORY(test)
    
